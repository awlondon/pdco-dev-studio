<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PDCo Dev Studio</title>

  <link rel="stylesheet" href="styles.css" />

  <script type="module" src="editorManager.js"></script>
</head>
  


  
<body>
  <div id="modal-root" class="modal-root hidden" role="dialog" aria-modal="true" aria-hidden="true"></div>
  <div
    id="root"
    class="hidden"
    data-user-id=""
    data-email=""
    data-remaining-credits="500"
    data-credits-total="500"
    data-daily-limit="50"
    data-today-credits-used="0"
    data-credits-reset-days="12"
    data-daily-reset-time="6h 12m"
    data-plan-label="Free"
    data-free-tier-remaining="10"
  >
    <header id="top-bar">
      <div>
        <h1>PDCo Dev Studio</h1>
        <p class="subtitle">Chat with the model, edit code, and run it live.</p>
      </div>
      <div class="top-bar-actions">
        <button id="publicGalleryButton" class="ghost-button subtle" type="button">
          Public Gallery
        </button>
        <span id="status-label">Offline</span>
        <div id="creditBadge" class="credit-badge" role="button" tabindex="0" aria-haspopup="dialog" aria-expanded="false">
          <span class="icon" aria-hidden="true"></span>
          <span class="count"></span>
          <span class="credit-badge-tooltip">Credits power generations. Resets monthly.</span>
        </div>
        <div class="user-menu">
          <button class="user-trigger" id="userMenuTrigger" type="button">
            <span class="user-avatar" id="userAvatar">JD</span>
            <span class="user-meta">
              <span class="user-name" id="userName">Jane Doe</span>
              <span class="user-plan" id="userPlanCredits">Credits: 0 ¬∑ Plan: Free</span>
            </span>
            <span class="chevron">‚ñæ</span>
          </button>

          <div class="user-dropdown" id="userMenu">
            <button class="menu-item" id="accountLink">
              Account
            </button>
            <button class="menu-item" id="profileEditLink">
              Edit profile
            </button>

            <button class="menu-item" id="galleryLink">
              My Gallery
            </button>

            <button class="menu-item" id="upgradePlan">
              Billing
            </button>

            <div class="menu-divider"></div>

            <button class="menu-item danger" id="signOutBtn">
              Sign out
            </button>
          </div>
        </div>
      </div>
    </header>

    <div id="credit-panel" class="credit-panel hidden" role="dialog" aria-label="Credits">
      <div class="credit-panel-header">Credits</div>
      <button class="ghost-button credit-panel-cta" type="button" data-open-usage>View usage</button>
      <div class="credit-meter">
        <div class="bar">
          <div class="fill"></div>
        </div>
        <div class="label">0 / 0</div>
      </div>
      <div class="credit-panel-meta">
        <div id="credit-reset">Resets in 12 days</div>
        <div id="credit-daily-limit">Daily limit: 500 credits</div>
      </div>
      <div class="credit-session">
        <div class="credit-session-title">Current session</div>
        <div class="credit-session-metrics">
          <div>
            <span>Turns</span>
            <span id="session-turns">0</span>
          </div>
          <div>
            <span>Credits used</span>
            <span id="session-credits">~0</span>
          </div>
          <div>
            <span>Duration</span>
            <span id="session-duration">0 min</span>
          </div>
        </div>
        <div id="session-previous" class="credit-session-previous hidden"></div>
      </div>
      <div id="credit-daily-message" class="credit-panel-callout hidden"></div>
      <div id="credit-upgrade-nudge" class="credit-panel-nudge hidden">
        Upgrade for higher limits and uninterrupted generation.
      </div>
    </div>

    <main id="account-page" class="account-page hidden" aria-label="Account">
      <div class="account-header">
        <div>
          <h2>Account</h2>
          <p class="account-subtitle">Operational details about your identity, plan, and usage.</p>
        </div>
        <div class="account-header-actions">
          <button id="accountProfileEdit" class="ghost-button subtle" type="button">Edit profile</button>
          <button id="accountBack" class="ghost-button" type="button">Back to workspace</button>
        </div>
      </div>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Account overview</h3>
          <p>Identity and authentication details for support and debugging.</p>
        </div>
        <div class="account-grid">
          <div class="account-card">
            <div class="account-field">
              <span class="account-label">Email</span>
              <span id="accountEmail" class="account-value">‚Äî</span>
            </div>
            <div class="account-field">
              <span class="account-label">Auth methods</span>
              <span id="accountAuthMethods" class="account-value">‚Äî</span>
            </div>
          </div>
          <div class="account-card">
            <div class="account-field">
              <span class="account-label">Account created</span>
              <span id="accountCreatedDate" class="account-value">‚Äî</span>
            </div>
            <div class="account-field">
              <span class="account-label">Account age</span>
              <span id="accountAge" class="account-value">‚Äî</span>
            </div>
          </div>
        </div>
        <details class="account-details">
          <summary>User ID (for support)</summary>
          <div class="account-user-id">
            <span id="accountUserId" class="account-value">‚Äî</span>
            <button id="accountCopyUserId" class="ghost-button small" type="button">Copy</button>
          </div>
        </details>
      </section>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Billing dashboard</h3>
          <p>Manage your subscription, renewal cycle, and credit usage in one place.</p>
        </div>
        <div class="account-grid billing-dashboard-grid">
          <div class="account-card billing-summary-card">
            <div class="account-field">
              <span class="account-label">Current plan</span>
              <span id="accountPlanTier" class="account-value">‚Äî</span>
            </div>
            <div class="account-field">
              <span class="account-label">Credit balance</span>
              <span id="accountCreditsRemaining" class="account-value">‚Äî</span>
            </div>
            <div class="account-field">
              <span class="account-label">Next renewal</span>
              <span id="accountRenewalDate" class="account-value">‚Äî</span>
            </div>
            <div class="account-field">
              <span class="account-label">Billing status</span>
              <span id="accountBillingStatus" class="account-value">‚Äî</span>
            </div>
          </div>

          <div class="account-card billing-usage-card">
            <div class="account-field">
              <span class="account-label">Monthly usage</span>
              <span id="accountBillingUsageSummary" class="account-value">‚Äî</span>
            </div>
            <div class="billing-usage-meter" role="progressbar" aria-label="Monthly credit usage" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div id="accountBillingUsageFill" class="billing-usage-fill"></div>
            </div>
            <div class="account-field">
              <span class="account-label">Monthly allowance</span>
              <span id="accountCreditsTotal" class="account-value">‚Äî</span>
            </div>
            <div class="account-field">
              <span class="account-label">Days until renewal</span>
              <span id="accountCreditsReset" class="account-value">‚Äî</span>
            </div>
          </div>
        </div>

        <div class="account-action-row">
          <button id="accountPrimaryAction" class="ghost-button" type="button">Upgrade plan</button>
          <button id="accountManagePortal" class="ghost-button subtle" type="button">Open Stripe customer portal</button>
          <button id="accountBuyCredits" class="ghost-button subtle" type="button">Buy credits</button>
        </div>

        <div class="billing-upgrade-options">
          <p class="account-muted">Upgrade options</p>
          <div class="billing-plan-cards">
            <button type="button" class="billing-plan-option" data-plan-upgrade="starter">
              <span class="billing-plan-name">Starter</span>
              <span class="billing-plan-copy">For individual builders with higher monthly limits.</span>
            </button>
            <button type="button" class="billing-plan-option" data-plan-upgrade="pro">
              <span class="billing-plan-name">Pro</span>
              <span class="billing-plan-copy">Best for teams shipping production workflows.</span>
            </button>
            <button type="button" class="billing-plan-option" data-plan-upgrade="enterprise">
              <span class="billing-plan-name">Enterprise</span>
              <span class="billing-plan-copy">Advanced scale, support, and custom allocation.</span>
            </button>
          </div>
        </div>
      </section>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Current session snapshot</h3>
          <p>Live view of the session you‚Äôre in right now.</p>
        </div>
        <div class="account-card account-session-card">
          <div class="account-metric">
            <span class="account-label">Started</span>
            <span id="accountSessionStarted" class="account-value">‚Äî</span>
          </div>
          <div class="account-metric">
            <span class="account-label">Turns</span>
            <span id="accountSessionTurns" class="account-value">0</span>
          </div>
          <div class="account-metric">
            <span class="account-label">Credits used (est.)</span>
            <span id="accountSessionCredits" class="account-value">~0</span>
          </div>
          <div class="account-metric">
            <span class="account-label">Tokens in / out</span>
            <span id="accountSessionTokens" class="account-value">0 / 0</span>
          </div>
        </div>
        <div class="account-action-row">
          <button id="accountClearSession" class="ghost-button" type="button">Clear Chat / New Session</button>
          <button id="accountSaveSession" class="ghost-button subtle" type="button">Save Session</button>
        </div>
      </section>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Saved code</h3>
          <p>Artifacts distilled from your sessions.</p>
        </div>
        <div class="account-grid">
          <div class="account-card">
            <div class="account-field">
              <span class="account-label">Private artifacts</span>
              <span id="accountArtifactsPrivate" class="account-value">‚Äî</span>
            </div>
            <div class="account-field">
              <span class="account-label">Public artifacts</span>
              <span id="accountArtifactsPublic" class="account-value">‚Äî</span>
            </div>
          </div>
          <div class="account-card">
            <div class="account-field">
              <span class="account-label">Gallery</span>
              <span class="account-value">Manage and publish artifacts.</span>
            </div>
            <div class="account-field">
              <span class="account-label">Public profile</span>
              <span class="account-value">Share your artifacts with a public handle.</span>
            </div>
          </div>
        </div>
        <div class="account-action-row">
          <button id="accountViewGallery" class="ghost-button" type="button">View Gallery</button>
          <button id="accountViewPublicGallery" class="ghost-button subtle" type="button">View Public Gallery</button>
          <button id="accountViewProfile" class="ghost-button subtle" type="button">View public profile</button>
        </div>
      </section>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Preferences</h3>
          <p>Manage notifications and account-level preferences.</p>
        </div>
        <div class="account-card account-preferences">
          <label class="account-toggle">
            <input id="accountNewsletterOptIn" type="checkbox" />
            <span>
              <strong>Product updates</strong>
              <span class="account-muted">Receive product updates and announcements.</span>
            </span>
          </label>
          <label class="account-field compact" for="accountContextMode">
            <span class="account-label">Context mode</span>
            <select id="accountContextMode" class="account-select">
              <option value="aggressive">Aggressive</option>
              <option value="balanced" selected>Balanced</option>
              <option value="full">Full</option>
            </select>
            <span class="account-muted">Controls how much historical context is sent per request.</span>
          </label>
          <p id="accountPreferencesStatus" class="account-muted">Preferences sync automatically.</p>
        </div>
      </section>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Usage history</h3>
          <p>Session-level usage over the last 30 days.</p>
        </div>
        <div class="account-table-wrapper">
          <table class="account-table">
            <thead>
              <tr>
                <th>Session start</th>
                <th>Duration</th>
                <th>Turns</th>
                <th>Credits used</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="accountSessionHistoryBody"></tbody>
          </table>
          <div id="accountSessionHistoryEmpty" class="account-empty hidden">
            No session history available yet.
          </div>
        </div>
        <div class="account-action-row align-between">
          <span id="accountHistoryRange" class="account-muted">Last 30 days</span>
          <button id="accountHistoryLoadMore" class="ghost-button subtle" type="button">Load more</button>
        </div>
      </section>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Monthly usage summary</h3>
          <p>Aggregated usage for the current month.</p>
        </div>
        <div class="account-grid">
          <div class="account-card">
            <div class="account-field">
              <span class="account-label">Credits used</span>
              <span id="accountMonthCredits" class="account-value">‚Äî</span>
            </div>
          </div>
          <div class="account-card">
            <div class="account-field">
              <span class="account-label">Total sessions</span>
              <span id="accountMonthSessions" class="account-value">‚Äî</span>
            </div>
          </div>
          <div class="account-card">
            <div class="account-field">
              <span class="account-label">Avg credits per session</span>
              <span id="accountMonthAvgCredits" class="account-value">‚Äî</span>
            </div>
          </div>
        </div>
      </section>

      <section class="account-section">
        <div class="account-section-header">
          <h3>Downloads &amp; exports</h3>
          <p>Export session data for your records.</p>
        </div>
        <div class="account-action-row">
          <button id="accountDownloadLatest" class="ghost-button" type="button">Download latest session (JSON)</button>
          <button class="ghost-button subtle" type="button" disabled>Download all sessions (ZIP)</button>
          <button class="ghost-button subtle" type="button" disabled>Download monthly usage report (CSV)</button>
        </div>
        <p class="account-muted">Bulk exports are coming soon.</p>
      </section>

      <section class="account-section account-footer">
        <div class="account-section-header">
          <h3>Account actions</h3>
          <p>Security and support options.</p>
        </div>
        <div class="account-action-row">
          <button id="accountSignOut" class="ghost-button" type="button">Sign out</button>
          <button id="accountDelete" class="ghost-button danger" type="button">Delete account</button>
          <a class="ghost-button subtle" href="mailto:support@maya.dev">Support / contact</a>
        </div>
      </section>
    </main>

    <main id="workspace">
      <div id="left-pane" class="left-pane">
        <section id="chat-panel" class="panel">
          <div class="panel-header">
            <span>Chat</span>
            <div class="panel-header-actions">
              <button
                id="clearChatButton"
                class="icon-button"
                type="button"
                title="Clear chat"
                aria-label="Clear chat"
              >
                üßπ
              </button>
            </div>
          </div>
          <div id="chat-messages" class="panel-body"></div>
          <form id="chat-form" class="panel-footer">
            <div id="credit-banner" class="credit-banner hidden"></div>
            <div id="credit-inline-warning" class="credit-inline-warning hidden"></div>
            <label class="context-mode-control" for="chatContextMode">
              <span>Context Mode</span>
              <select id="chatContextMode" aria-label="Context Mode">
                <option value="balanced" selected>Balanced</option>
                <option value="aggressive">Aggressive</option>
                <option value="full">Full</option>
              </select>
            </label>
            <div id="throttleNotice" class="throttle hidden"></div>
            <div id="credit-zero" class="credit-zero hidden">
              <span>You are approaching your credit limit.</span>
              <span>Upgrade your plan or add credits to continue.</span>
              <div class="credit-cta">
                <button class="ghost-button" type="button">Upgrade Plan</button>
                <button class="ghost-button" type="button" data-open-usage>View Usage</button>
              </div>
            </div>
            <div id="loadingIndicator" class="loading hidden">
              <span class="dot">‚Ä¢</span>
              <span class="dot">‚Ä¢</span>
              <span class="dot">‚Ä¢</span>
              <span class="loading-label" aria-live="polite"></span>
              <span class="timer">0.0s</span>
            </div>
            <div class="chat-controls">
              <div class="playable-wrapper-container">
                <button
                  id="playable-controller-btn"
                  class="playable-btn"
                  disabled
                >
                  üéÆ
                </button>
              </div>

              <div class="chat-input-row">
                <div class="chat-input-wrapper">
                  <textarea id="chat-input" placeholder="Describe what you want to build or change."></textarea>
                  <div id="credit-preview" class="credit-preview" aria-live="polite"></div>
                </div>
                <button id="btn-mic" title="Speak" type="button">üéôÔ∏è</button>
                <button id="btn-send" type="submit">Send Chat</button>
              </div>
            </div>
          </form>
        </section>

      </div>

      <div id="right-pane" class="right-pane">
        <section id="code-panel" class="panel code-editor">
          <div class="panel-header">
            <span>Code Editor</span>
            <div class="panel-header-actions">
              <button id="saveCodeBtn" class="icon-button" title="Save code" type="button" disabled>
                üíæ
              </button>
              <button id="copyCodeBtn" class="icon-button" title="Copy code" type="button">
                üìã
              </button>
            </div>
          </div>
          <div id="code-editor-wrapper">
            <div id="code-editor" aria-label="Code editor"></div>
          </div>
          <div class="panel-footer actions">
            <div id="code-footer">
              <span id="line-count">Lines: 1</span>
            </div>
            <button id="runCode" type="button">Run Code</button>
            <button id="revertButton" type="button" title="Revert to previous version" disabled>
              ‚ü≤ Revert
            </button>
            <button id="forwardButton" type="button" title="Go to next code version" disabled>
              ‚ü≥ Forward
            </button>
            <button id="rollbackButton" type="button">Revert to last generated</button>
            <button id="promoteButton" type="button">Promote to baseline</button>
            <div id="generation-indicator" class="generation-indicator">
              Generating output
            </div>
          </div>
        </section>

        <div class="splitter" id="splitter" role="separator" aria-orientation="horizontal"></div>

        <section id="output-panel" class="panel output-panel">
          <div class="panel-header">
            <div class="panel-header-title">
              Console Output
              <span class="panel-header-label">Live Preview</span>
            </div>
            <div class="panel-header-actions">
              <div id="interfaceStatus" class="interface-status unchanged">
                Interface unchanged
              </div>
              <div id="previewExecutionStatus" class="preview-execution-status idle">
                Idle
              </div>
              <div id="executionWarnings" class="execution-warnings hidden" aria-live="polite"></div>
              <div id="previewStatus" class="preview-status">
                Preview updated.
              </div>
              <button id="viewDiffBtn" class="ghost-button" type="button" style="display:none;">
                View changes
              </button>
              <button id="fullscreenToggle" class="ghost-button" type="button">‚§¢ Fullscreen</button>
            </div>
          </div>
          <div class="panel-body">
            <div id="console-output-log" class="console-output-log"></div>
            <div id="consoleOutput" class="console-output" data-artifact-screenshot="true">
              <div id="sandbox-status" style="font-size:12px; opacity:0.7; font-family:monospace;">idle</div>
              <div id="sandbox-controls" class="sandbox-controls hidden" aria-label="Sandbox controls">
                <button id="sandboxPause" class="ghost-button" type="button">Pause</button>
                <button id="sandboxResume" class="ghost-button hidden" type="button">Resume</button>
                <button id="sandboxReset" class="ghost-button" type="button">Reset</button>
                <button id="sandboxStop" class="ghost-button" type="button">Stop</button>
              </div>
              <div id="previewFrameContainer" class="preview-frame-container">
                <iframe id="sandbox" sandbox="allow-scripts"></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </main>

    <main id="gallery-page" class="gallery-page hidden" aria-label="Saved code gallery">
      <div class="gallery-header">
        <div>
          <h2>Saved code</h2>
          <p class="gallery-subtitle">Artifacts distilled from your sessions.</p>
        </div>
        <div class="gallery-actions">
          <button id="galleryBackButton" class="ghost-button" type="button">Back to workspace</button>
        </div>
      </div>
      <div class="gallery-filters">
        <span class="gallery-muted">Private gallery</span>
      </div>
      <div id="galleryGrid" class="gallery-grid"></div>
      <div id="galleryEmpty" class="gallery-empty hidden">
        No artifacts saved yet. Use ‚ÄúSave Code‚Äù to create your first artifact.
      </div>
    </main>

    <main id="public-gallery-page" class="gallery-page hidden" aria-label="Public gallery">
      <div class="gallery-header">
        <div>
          <h2>Public gallery</h2>
          <p class="gallery-subtitle">Explore public artifacts and import them into your workspace.</p>
        </div>
        <div class="gallery-actions">
          <button id="publicGalleryBackButton" class="ghost-button" type="button">Back to workspace</button>
        </div>
      </div>
      <div class="gallery-filters">
        <div class="gallery-filter-row">
          <label class="gallery-search" for="publicGallerySearch">
            <span class="sr-only">Search public artifacts</span>
            <input id="publicGallerySearch" type="search" placeholder="Search titles or descriptions..." />
          </label>
          <label class="gallery-sort" for="publicGallerySort">
            <span>Sort</span>
            <select id="publicGallerySort">
              <option value="recent">Recent</option>
              <option value="forked">Most forked</option>
            </select>
          </label>
          <label class="gallery-sort" for="publicGalleryCategory">
            <span>Category</span>
            <select id="publicGalleryCategory">
              <option value="">All</option>
              <option value="general">General</option>
              <option value="ui">UI</option>
              <option value="animation">Animation</option>
              <option value="dashboard">Dashboard</option>
              <option value="tooling">Tooling</option>
            </select>
          </label>
        </div>
        <div class="gallery-tags-row">
          <span class="gallery-muted">Tags</span>
          <div id="publicGalleryTagChips" class="gallery-tags"></div>
        </div>
      </div>
      <div id="publicGalleryGrid" class="gallery-grid"></div>
      <div id="publicGalleryEmpty" class="gallery-empty hidden">
        No public artifacts yet.
      </div>
      <div id="publicGalleryPagination" class="gallery-pagination hidden">
        <button id="publicGalleryPrev" class="ghost-button" type="button">Previous</button>
        <span id="publicGalleryPageLabel" class="gallery-muted">Page 1 of 1</span>
        <button id="publicGalleryNext" class="ghost-button" type="button">Next</button>
      </div>
    </main>

    <main id="public-profile-page" class="profile-page hidden" aria-label="Public profile">
      <div class="profile-header">
        <div class="profile-identity">
          <div class="profile-avatar">
            <img id="profileAvatar" alt="Profile avatar" />
          </div>
          <div class="profile-meta">
            <h2 id="profileDisplayName">‚Äî</h2>
            <div id="profileHandle" class="profile-handle">@handle</div>
            <p id="profileBio" class="profile-bio">‚Äî</p>
            <div id="profileLocation" class="profile-location hidden"></div>
          </div>
        </div>
        <div class="profile-actions">
          <button id="profileBackButton" class="ghost-button" type="button">Back</button>
        </div>
      </div>
      <div class="profile-stats">
        <div>
          <span id="profileStatArtifacts" class="profile-stat-value">0</span>
          <span class="profile-stat-label">Artifacts</span>
        </div>
        <div>
          <span id="profileStatLikes" class="profile-stat-value">0</span>
          <span class="profile-stat-label">Likes</span>
        </div>
        <div>
          <span id="profileStatComments" class="profile-stat-value">0</span>
          <span class="profile-stat-label">Comments</span>
        </div>
        <div>
          <span id="profileStatForks" class="profile-stat-value">0</span>
          <span class="profile-stat-label">Forks</span>
        </div>
      </div>
      <div class="profile-tabs" role="tablist">
        <button class="ghost-button small is-active" type="button" data-profile-tab="artifacts">Public artifacts</button>
        <button class="ghost-button small" type="button" data-profile-tab="forks">Forks</button>
        <button class="ghost-button small" type="button" data-profile-tab="about">About</button>
      </div>
      <section id="profileTabArtifacts" class="profile-tab-panel">
        <div id="profileArtifactsGrid" class="gallery-grid"></div>
        <div id="profileArtifactsEmpty" class="gallery-empty hidden">No public artifacts yet.</div>
      </section>
      <section id="profileTabForks" class="profile-tab-panel hidden">
        <div id="profileForksGrid" class="gallery-grid"></div>
        <div id="profileForksEmpty" class="gallery-empty hidden">No forks shared yet.</div>
      </section>
      <section id="profileTabAbout" class="profile-tab-panel hidden">
        <div class="profile-about">
          <div>
            <span class="profile-about-label">Bio</span>
            <p id="profileAboutBio" class="profile-about-value">‚Äî</p>
          </div>
          <div>
            <span class="profile-about-label">Demographics</span>
            <p id="profileAboutDemographics" class="profile-about-value">‚Äî</p>
          </div>
          <div>
            <span class="profile-about-label">Member since</span>
            <p id="profileAboutCreated" class="profile-about-value">‚Äî</p>
          </div>
        </div>
      </section>
    </main>

    <main id="profile-edit-page" class="profile-page hidden" aria-label="Edit profile">
      <div class="profile-header">
        <div>
          <h2>Edit profile</h2>
          <p class="profile-subtitle">Manage your public identity, handle, and optional demographics.</p>
        </div>
        <div class="profile-actions">
          <button id="profileEditBackButton" class="ghost-button" type="button">Back</button>
        </div>
      </div>
      <form id="profileEditForm" class="profile-edit-form">
        <div class="profile-edit-grid">
          <div class="profile-avatar-editor">
            <div class="profile-avatar large">
              <img id="profileEditAvatarPreview" alt="Profile avatar preview" />
            </div>
            <label class="ghost-button small">
              Upload avatar
              <input id="profileAvatarInput" type="file" accept="image/*" hidden />
            </label>
            <p class="profile-helper">Square images look best. Optional.</p>
          </div>
          <div class="profile-edit-fields">
            <label class="modal-field">
              <span>Handle</span>
              <input id="profileHandleInput" type="text" placeholder="your_handle" />
              <span id="profileHandleStatus" class="profile-helper"></span>
            </label>
            <label class="modal-field">
              <span>Display name</span>
              <input id="profileDisplayNameInput" type="text" placeholder="Name shown on your profile" />
            </label>
            <label class="modal-field">
              <span>Bio</span>
              <textarea id="profileBioInput" rows="3" maxlength="280" placeholder="What are you building?"></textarea>
              <span id="profileBioCount" class="profile-helper">0 / 280</span>
            </label>
            <div class="profile-demographics">
              <label class="modal-field">
                <span>Age</span>
                <input id="profileAgeInput" type="number" min="0" placeholder="Optional" />
              </label>
              <label class="modal-field">
                <span>Gender</span>
                <input id="profileGenderInput" type="text" placeholder="Optional" />
              </label>
              <label class="modal-field">
                <span>City</span>
                <input id="profileCityInput" type="text" placeholder="Optional" />
              </label>
              <label class="modal-field">
                <span>Country</span>
                <input id="profileCountryInput" type="text" placeholder="Optional" />
              </label>
            </div>
          </div>
        </div>
        <div class="profile-edit-actions">
          <button id="profileSaveButton" type="submit">Save profile</button>
          <button id="profileCancelButton" class="ghost-button subtle" type="button">Cancel</button>
        </div>
      </form>
    </main>

    <div id="pricing-modal" class="pricing-modal hidden" role="dialog" aria-modal="true" aria-labelledby="pricing-title">
      <div class="pricing-modal-panel">
        <div class="pricing-modal-header">
          <div>
            <h2 id="pricing-title">Simple, predictable pricing ‚Äî built for creators</h2>
            <p class="pricing-modal-subtitle">Use credits to generate interfaces, visuals, and interactive code. No surprise bills. No token math.</p>
          </div>
          <div class="pricing-modal-actions">
            <button id="pricing-close" class="ghost-button" type="button">Close</button>
          </div>
        </div>
        <div id="pricing-modal-body" class="pricing-modal-body pricing-body">
          <div class="pricing-section">
            <h3>How credits work</h3>
            <ul>
              <li>You use credits to generate code and interfaces.</li>
              <li>Each action costs a small number of credits based on complexity.</li>
              <li>Daily limits protect you from burning everything at once.</li>
              <li>You can upgrade or top up anytime.</li>
            </ul>
          </div>

          <div class="pricing-section">
            <h3>Plans</h3>
            <div class="pricing-tiers" id="pricing-plan-grid"></div>
            <div id="pricing-plan-actions" class="pricing-plan-actions"></div>
          </div>

          <div class="pricing-section">
            <h3>Need more?</h3>
            <ul>
              <li>Buy extra credits anytime.</li>
              <li>Unused credits roll over while your subscription is active.</li>
            </ul>
          </div>

          <div class="pricing-section">
            <h3>Transparency note</h3>
            <p>You‚Äôll always see:</p>
            <ul>
              <li>how many credits an action will likely use</li>
              <li>how many credits you have left</li>
              <li>warnings before you run low</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div id="paywall-modal" class="paywall-modal hidden" role="dialog" aria-modal="true" aria-label="Upgrade options">
      <div class="paywall-backdrop" data-paywall-backdrop></div>
      <div class="paywall-sheet" role="document">
        <div class="paywall-header">
          <div class="paywall-header-copy">
            <h2 id="paywall-title">Daily limit reached</h2>
            <p id="paywall-subtext" class="paywall-subtext"></p>
          </div>
          <button id="paywall-close" class="icon-button hidden" type="button" aria-label="Close paywall">‚úï</button>
        </div>
        <div class="paywall-body">
          <div class="paywall-status-card" aria-live="polite">
            <div class="status-row">
              <span>Current plan</span>
              <strong id="paywall-current-plan">Free</strong>
            </div>
            <div class="status-row">
              <span>Credits remaining</span>
              <strong id="paywall-credits-remaining">0 / 0</strong>
            </div>
            <div class="status-row">
              <span>Daily throttle</span>
              <strong id="paywall-daily-throttle">0 credits left today</strong>
            </div>
          </div>

          <div class="paywall-plans">
            <div class="paywall-plan-compact" data-paywall-compact>
              <div id="paywall-plan-cards" class="paywall-plan-cards"></div>
            </div>

            <div class="paywall-plan-comparison hidden" data-paywall-compare>
              <div id="paywall-plan-selector" class="paywall-plan-selector" role="tablist" aria-label="Select a plan"></div>
              <div id="paywall-plan-table"></div>
              <p class="paywall-note">All plans include live code execution and sandboxed previews.</p>
            </div>
          </div>

          <p id="paywall-cost-line" class="paywall-cost-line">
            Credits abstract API costs. On your usage, Starter covers ~10√ó more generations than Free.
            <button class="link-button paywall-inline-link" type="button" data-tooltip="Credits map to API costs so plan limits stay stable." aria-label="Learn how credits work">
              Learn how credits work
            </button>
          </p>
          <div class="paywall-actions">
            <button id="paywall-primary" class="primary-button" type="button">Upgrade Plan</button>
            <button id="paywall-secondary" class="ghost-button" type="button">Compare plans</button>
            <button id="paywall-tertiary" class="link-button" type="button">Maybe later</button>
          </div>
          <p id="paywall-footer" class="paywall-footer">Billing handled securely via Stripe. Cancel anytime.</p>
        </div>
      </div>
    </div>

    <div id="upgradeModal" class="upgrade-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="upgrade-title">
      <div class="upgrade-modal" role="document">
        <button class="upgrade-close" type="button" data-upgrade-close aria-label="Close upgrade dialog">√ó</button>

        <header class="upgrade-header">
          <h2 id="upgrade-title">You‚Äôre nearing your usage limit</h2>
          <p class="upgrade-subtitle">
            You‚Äôve used <strong>87%</strong> of your monthly credits. Upgrading removes throttles and increases limits.
          </p>
        </header>

        <section class="upgrade-status">
          <div><span>Current plan</span><strong>Free</strong></div>
          <div><span>Credits remaining</span><strong>62 / 500</strong></div>
          <div><span>Daily throttle</span><strong>2 requests left</strong></div>
        </section>

        <section class="upgrade-plans">
          <div class="plan">
            <h3>Free</h3>
            <p class="plan-price">$0</p>
            <ul>
              <li>500 credits / month</li>
              <li>Strict daily throttle</li>
              <li>Limited large generations</li>
            </ul>
          </div>

          <div class="plan plan-featured">
            <h3>Starter</h3>
            <p class="plan-price">$12 / mo</p>
            <ul>
              <li>5,000 credits / month</li>
              <li>Relaxed throttling</li>
              <li>Large generations enabled</li>
            </ul>
            <button class="plan-cta primary" type="button">Upgrade to Starter</button>
          </div>

          <div class="plan">
            <h3>Pro</h3>
            <p class="plan-price">$29 / mo</p>
            <ul>
              <li>20,000 credits / month</li>
              <li>Minimal throttling</li>
              <li>Priority queue</li>
            </ul>
            <button class="plan-cta" type="button">Upgrade to Pro</button>
          </div>
        </section>

        <footer class="upgrade-footer">
          <p>
            Credits abstract API costs. On your current usage, Starter supports ~10√ó more generations than Free.
          </p>
          <p class="upgrade-note">
            Billing handled securely via Stripe. Cancel anytime.
          </p>
        </footer>
      </div>
    </div>

    <div id="usage-modal" class="usage-modal hidden" role="dialog" aria-modal="true" aria-label="Usage analytics">
      <div class="usage-panel">
        <div class="usage-header">
          <div>
            <h2>Usage analytics</h2>
            <p id="usage-scope-label" class="usage-scope">Your usage this month</p>
          </div>
          <button id="usage-close" class="icon-button" type="button" aria-label="Close usage analytics">‚úï</button>
        </div>

        <div id="usage-filters" class="usage-filters hidden">
          <label class="usage-filter">
            <span>User</span>
            <select id="usage-user-filter"></select>
          </label>
          <label class="usage-filter">
            <span>Plan tier</span>
            <select id="usage-plan-filter">
              <option value="all">All tiers</option>
              <option value="free">Free</option>
              <option value="starter">Starter</option>
              <option value="pro">Pro</option>
              <option value="power">Power</option>
            </select>
          </label>
          <label class="usage-filter">
            <span>Date range</span>
            <div class="usage-filter-range">
              <input id="usage-start-date" type="date" />
              <span>‚Üí</span>
              <input id="usage-end-date" type="date" />
            </div>
          </label>
          <button id="usage-apply-filters" class="ghost-button" type="button">Apply</button>
        </div>

        <div class="usage-tabs" role="tablist">
          <button class="usage-tab active" type="button" role="tab" data-tab="overview" aria-selected="true">Overview</button>
          <button class="usage-tab" type="button" role="tab" data-tab="daily" aria-selected="false">Daily</button>
          <button class="usage-tab" type="button" role="tab" data-tab="history" aria-selected="false">History</button>
        </div>

        <div class="usage-tab-panel active" data-tab-panel="overview" role="tabpanel">
          <div class="usage-cards">
            <div class="usage-card">
              <span>Credits used (month)</span>
              <strong id="usage-credits-month">0</strong>
            </div>
            <div class="usage-card">
              <span>Requests (month)</span>
              <strong id="usage-requests-month">0</strong>
            </div>
            <div class="usage-card">
              <span>Avg latency</span>
              <strong id="usage-latency-month">0s</strong>
            </div>
            <div class="usage-card">
              <span>Success rate</span>
              <strong id="usage-success-month">0%</strong>
            </div>
          </div>
          <div class="usage-chart-card">
            <div class="usage-chart-header">
              <div>
                <h3>Credit burn</h3>
                <p>Credits used per day ¬∑ capped by daily limit</p>
              </div>
              <span id="usage-range-label" class="usage-range-label">Last 14 days</span>
            </div>
            <canvas id="credits-chart" height="150"></canvas>
          </div>
          <div class="usage-chart-card">
            <div class="usage-chart-header">
              <div>
                <h3>Token consumption by model</h3>
                <p>Input + output tokens grouped by model</p>
              </div>
            </div>
            <canvas id="token-model-chart" height="150"></canvas>
          </div>
        </div>

        <div class="usage-tab-panel" data-tab-panel="daily" role="tabpanel">
          <div class="usage-chart-card">
            <div class="usage-chart-header">
              <div>
                <h3>Requests per day</h3>
                <p>Stacked by intent (code vs text)</p>
              </div>
            </div>
            <canvas id="requests-chart" height="140"></canvas>
          </div>
          <div class="usage-chart-card">
            <div class="usage-chart-header">
              <div>
                <h3>Latency trend</h3>
                <p>Average latency per day</p>
              </div>
            </div>
            <canvas id="latency-chart" height="140"></canvas>
          </div>
          <div class="usage-chart-card">
            <div class="usage-chart-header">
              <div>
                <h3>Request token profile</h3>
                <p>Latest requests by token size</p>
              </div>
            </div>
            <canvas id="token-request-chart" height="140"></canvas>
          </div>
          <button id="usage-load-more" class="ghost-button" type="button">Load more</button>
        </div>

        <div class="usage-tab-panel" data-tab-panel="history" role="tabpanel">
          <table class="usage-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Requests</th>
                <th>Credits</th>
                <th>Avg latency</th>
                <th>Failures</th>
                <th>Tokens</th>
              </tr>
            </thead>
            <tbody id="usage-history-body"></tbody>
          </table>
          <div id="usage-history-empty" class="usage-empty hidden">No usage history yet.</div>
        </div>
      </div>
    </div>
    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>
  <script>
    window.GOOGLE_CLIENT_ID = "136741418395-m12209atcs99mia868fh6o3m266u7noa.apps.googleusercontent.com";
  </script>
  <script>
    window.__MAYA_API_BASE = "https://maya-api-xxxxx-uc.a.run.app";
  </script>
  <script type="module" src="app.js"></script>
</body>
</html>
